<!DOCTYPE html>
<html>
  <head>
    <title>Live Transcription</title>
  </head>
  <body>
    <h1>Transcribe Audio With FastAPI</h1>
    <p id="status">Connection status will go here</p>
    <p id="transcript"></p>
  </body>
  <script>
    const websocket = new WebSocket("ws://127.0.0.1:8000/ws_a");

    websocket.onopen = ()=>{
        document.querySelector("#status").textContent = "Connected";

        navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
            const mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.addEventListener("dataavailable",async (event)=>{
                if(event.data.size > 0 && websocket.readyState == 1){
                  console.log(event.data)
                    websocket.send(event.data)
                }
            })


            mediaRecorder.start()
            window.addEventListener("click",(e)=>{
                mediaRecorder.stop()
            })
        });
        

        
      }

    // socket.onopen = () => {
    //   document.querySelector("#status").textContent = "Connected";
    //   console.log({
    //     event: "onopen",
    //   });
    //   mediaRecorder.addEventListener("dataavailable", async (event) => {
    //     if (event.data.size > 0 && socket.readyState == 1) {
    //       socket.send(event.data);
    //     }
    //   });
    //   mediaRecorder.start(250);
    // };

    // socket.onmessage = (message) => {
    //   const received = message.data;
    //   if (received) {
    //     console.log(received);
    //     document.querySelector("#transcript").textContent += " " + received;
    //   }
    // };

    // socket.onclose = () => {
    //   console.log({
    //     event: "onclose",
    //   });
    // };

    // socket.onerror = (error) => {
    //   console.log({
    //     event: "onerror",
    //     error,
    //   });
    // };
  </script>
</html>
